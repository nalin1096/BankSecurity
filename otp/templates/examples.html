{% load staticfiles %}
<!DOCTYPE html>
<html>
<head>
    <title>Login</title>
    <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/jquery.material.form.css' %}">
   <!--  <link rel="stylesheet" type="text/css" href="{% static 'css/material-font.css' %}"> -->
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" type = "text/css"/>
    <link href="{% static 'css/landing-page.css' %}" rel="stylesheet" type = "text/css"/>
    <meta id="first_digit" data-name="{{first_digit}}">
    <meta id="second_digit" data-name="{{second_digit}}">
    <meta id="third_digit" data-name="{{third_digit}}">
    <meta id="fourth_digit" data-name="{{fourth_digit}}">
    <meta id="fifth_digit" data-name="{{fifth_digit}}">
    <meta id="sixth_digit" data-name="{{sixth_digit}}">
    <meta id="random_number1" data-name="{{random_number1}}">
    <meta id="random_number2" data-name="{{random_number2}}">
</head>
<body>
{% if registered %}
	<strong>Thank you for registering!</strong>
	<a href="/">Return to the homepage.</a><br />
{% else %}
	<div class="container"> 
	    <center><h1>Test OTP</h1></center>
	    <h5><center>
	    <div class=row>
	    	<div class="col-md-6" align="right">
	    	First Transformation: 
	    	</div>
	    	<div class="col-md-6" align="left">
	    	{{first_digit}}
	    	</div>
	    </div>
    	<div class=row>
	    	<div class="col-md-6" align="right">
	    	Second Transformation: 
	    	</div>
	    	<div class="col-md-6" align="left">
	    	{{second_digit}}
    	</div>
    	<div class=row>
	    	<div class="col-md-6" align="right">
	    	Third Transformation: 
	    	</div>
	    	<div class="col-md-6" align="left">
	    	{{third_digit}}
	    	</div>
	    </div>
	    <div class=row>
	    	<div class="col-md-6" align="right">
	    	Fourth Transformation: 
	    	</div>
	    	<div class="col-md-6" align="left">
	    	{{fourth_digit}}
	    	</div>
	    </div>
	    <div class=row>
	    	<div class="col-md-6" align="right">
	    	Fifth Transformation: 
	    	</div>
	    	<div class="col-md-6" align="left">
	    	{{fifth_digit}}
	    	</div>
	    </div>
	    <div class=row>
	    	<div class="col-md-6" align="right">
	    	Sixth Transformation: 
	    	</div>
	    	<div class="col-md-6" align="left">
	    	{{sixth_digit}}
	    	</div>
	    </div>
	    </div>
	  	</center></h5>
	<form action="/examples/" id="login_form" method="post" class="material"> {% csrf_token %}
		<center><H3>Random OTP: {{ random_number1 }}</H3></center> <br>
	    <input type="text" name="example1" placeholder="Example 1" id="inp1"><br>
	    <center><H3>Random OTP: {{ random_number2 }}</H3></center> <br>
	    <input type="text" name="example2" placeholder="Example 2" id="inp2"> <br>
	    <center><button type="submit" name="_submit" class="btn">Submit</button></center>
	</form>
	</div>

	<!-- <script type="text/javascript" src="{% static 'js/jquery-2.0.3.min.js' %}"></script> --> <!-- JQUERY -->
	<script type="text/javascript" src = "https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
	<script type="text/javascript" src="{% static 'js/jquery.validate.min.js' %}"></script> <!-- JQUERY VALIDATOR (additional) -->
	<script type="text/javascript" src="{% static 'js/jquery.material.form.js' %}"></script> <!-- JQUERY MATERIAL FORM PLUGIN -->

	<script type="text/javascript">
	    $(function(){
	        $('form.material').materialForm(); // Apply material
	        $('form').validate({ 
	            errorPlacement: function(error, element) {}
	        }); // Apply validator with no error messages but classes only
	    });
	</script>

	<script type="text/javascript">

		function sub_func (digits,operand) {
			var operand_size = operand.length;
			var digit = operand[0];
			var num = 0;
			if (digit == 'a'){
				num = digits[0];
			}
			else if (digit == 'b'){
				num = digits[1];
			}
			else if (digit == 'c'){
				num = digits[2];
			}
			else if (digit == 'd'){
				num = digits[3];
			}
			else if (digit == 'e'){
				num = digits[4];
			}
			else if (digit == 'f'){
				num = digits[5];
			}
			// else if (digit == 'g'){
			// 	num = datetime.datetime.now().day
			// 	if (num.toString().length== 1){
			// 		num = 0;
			// 	}
			// 	else {
			// 		num = Math.floor(num/10);
			// 	}
			// }
			// else if (digit == 'h'){
			// 	num = datetime.datetime.now().day;
			// 	if (num.toString().length != 1){
			// 		num = num % 10;
			// 	}
			// }
			// else if (digit == 'i'):
			// 	num = datetime.datetime.now().month;
			// 	if (num.toString().length == 1){
			// 		num = 0;
			// 	}
			// 	else{
			// 		num = Math.floor(num/10);
			// 	}
			// elif digit == 'j':
			// 	num = datetime.datetime.now().month
			// 	if len(str(num)) != 1:
			// 		num = num % 10
			// elif digit == 'k':
			// 	num = min(digits)
			// elif digit == 'l':
			// 	temp_digits = set(digits)
			// 	temp_digits.remove(min(temp_digits))
			// 	num = min(temp_digits)

			modifier = operand.slice(1,operand_size)

			if (modifier == ''){
				num = num;
			}
			else if (modifier == '-'){
				num = (10-num) % 10;
			}
			else if (modifier == '~'){
				num = (9-num);
			}
			else if (modifier == '^2'){
				num = (num*num)%10;
			}

			return num;
		}

		function otp_extract (digits,func,index) {
			if (func==''){
				return digits[index];
			}
			var func_size = func.length;
			var operand1 = '';
			var operand2 = '';
			var operator = '';
			var flag = 0;
			for (i=0; i<func_size; i++){
				if (func[i] != '+' && func[i] != '*'){
					operand1 = operand1 + func[i];
				}
				else {
					flag = i;
					break;
				}
			}
			operator = func[flag];
			
			for (i=flag+1; i<func_size; i++) {
				operand2 = operand2 + func[i];
			}

			sub1 = sub_func(digits,operand1);
			sub2 = sub_func(digits,operand2);

			if (operator=='+'){
				return (sub1+sub2)%10;
			}
			else if (operator=='*'){
				return (sub1*sub2)%10;
			}
		} 

		var first_digit = $('#first_digit').data().name;
		var second_digit = $('#second_digit').data().name;
		var third_digit = $('#third_digit').data().name;
		var fourth_digit = $('#fourth_digit').data().name;
		var fifth_digit = $('#fifth_digit').data().name;
		var sixth_digit = $('#sixth_digit').data().name;
		var random_number1 =  $('#random_number1').data().name;
		var random_number2 =  $('#random_number2').data().name;

		var temp1 = random_number1;
		var digits1 = [];	
		while (temp1!=0) {
			digits1.push(temp1%10);
			temp1 = Math.floor(temp1/10);
		}
		digits1 = digits1.reverse();

		var temp2 = random_number2;
		var digits2 = [];	
		while (temp2!=0) {
			digits2.push(temp2%10);
			temp2= Math.floor(temp2/10);
		}
		digits2 = digits2.reverse();

		var func1 = first_digit.replace(" ","");
		var func2 = second_digit.replace(" ","");
		var func3 = third_digit.replace(" ","");
		var func4 = fourth_digit.replace(" ","");
		var func5 = fifth_digit.replace(" ","");
		var func6 = sixth_digit.replace(" ","");

		var otp1 = otp_extract (digits1,func1,0);
		var otp2 = otp_extract (digits1,func2,1);
		var otp3 = otp_extract (digits1,func3,2);
		var otp4 = otp_extract (digits1,func4,3);
		var otp5 = otp_extract (digits1,func5,4);
		var otp6 = otp_extract (digits1,func6,5);

		var expected_otp1 = otp1.toString().concat(otp2.toString()+otp3.toString()+otp4.toString()+otp5.toString()+otp6.toString());

		otp1 = otp_extract (digits2,func1,0);
		otp2 = otp_extract (digits2,func2,1);
		otp3 = otp_extract (digits2,func3,2);
		otp4 = otp_extract (digits2,func4,3);
		otp5 = otp_extract (digits2,func5,4);
		otp6 = otp_extract (digits2,func6,5);

		var expected_otp2 = otp1.toString().concat(otp2.toString()+otp3.toString()+otp4.toString()+otp5.toString()+otp6.toString());

		console.log(expected_otp1);
		console.log(expected_otp2);

		var val1 = "";
		$("#inp1").keyup(function() {
    		val1 = $(this).val();
    		if (expected_otp1==val1) {
    			$(this).css("color", "#00b200");
    		}
    		else {
    			$(this).css("color","#ff0000");
    		}
		}).change();

		var val2 = "";
		$("#inp2").keyup(function() {
    		val2 = $(this).val();
    		if (expected_otp2==val2) {
    			$(this).css("color", "#00b200");
    		}
    		else {
    			$(this).css("color","#ff0000");
    		}
		}).change();
		

	</script>
{% endif %}
</body>
</html>

